# jwt(json web token)

## 1.为什么要有jwt?

什么是jwt？

服务端接受到客户端的请求返回一个有时间限制的token（json格式）,客户端每次向服务端发送请求时都要带上这个token，服务的并不保存这个请求，只是验证它的合法性。他是一种无状态的验证方式。

1.传统的session cookie的弊端？

* 用户多后，占用的内存很大
* 通用性不如jwt（不同语言开发环境下session，cookie的实现方式不同）而jwt只保存在客户端
* CSRF: 因为是基于cookie来进行用户识别的, cookie如果被截获，用户就会很容易受到跨站请求伪造的攻击。

2.json的优点：

因为json的通用性。所以JWT是可以跨语言的
因为有了payload部分 所以JWT可以在自身存储一些其他业务所必要的敏感信息
便于传输 JWT构成非常简单 字节占用很小 所以它是非常便于传输的
他不需要在服务端保存会话信息，所以她易于应用的扩展

## 2.json的缺点

缺点一： 无法满足注销场景

传统的 session+cookie 方案用户点击注销，服务端清空 session 即可，因为状态保存在服务端。但 jwt 的方案就比较难办了，因为 jwt 是无状态的，服务端通过计算来校验有效性。没有存储起来，所以即使客户端删除了 jwt，但是该 jwt 还是在有效期内，只不过处于一个游离状态。

缺点二： 无法满足修改密码场景

修改密码则略微有些不同，假设号被到了，修改密码（是用户密码，不是 jwt 的 secret）之后，盗号者在原 jwt 有效期之内依旧可以继续访问系统，所以仅仅清空 cookie 自然是不够的，这时，需要强制性的修改 secret。

缺点三： 无法满足token续签场景

我们知道微信只要你每天使用是不需要重新登录的，因为有token续签，因为传统的 cookie 续签方案一般都是框架自带的，session 有效期 30 分钟，30 分钟内如果有访问，session 有效期被刷新至 30 分钟。但是 jwt 本身的 payload 之中也有一个 exp 过期时间参数，来代表一个 jwt 的时效性，而 jwt 想延期这个 exp 就有点身不由己了，因为 payload 是参与签名的，一旦过期时间被修改，整个 jwt 串就变了，jwt 的特性天然不支持续签！



## 3.JWT应用场景

一次性验证

> 比如用户注册后需要发一封邮件让其激活账户，通常邮件中需要有一个链接，这个链接需要具备以下的特性：能够标识用户，该链接具有时效性（通常只允许几小时之内激活），不能被篡改以激活其他可能的账户

这种场景就和 jwt 的特性非常贴近，jwt 的 payload 中固定的参数：iss 签发者和 exp 过期时间正是为其做准备的。

## 4.总结

Web 应用中使用 JWT 是让应用变得更复杂了。在 web 应用中，绝大多数情况下，传统的 cookie-session 机制工作得更好。jwt 适合做简单的 restful api 认证，颁发一个固定有效期的 jwt，降低 jwt 暴露的风险，不要对 jwt 做服务端的状态管理，这样才能体现出 jwt 无状态的优势。

两者（session jwt）的比较:

无论session还是cookies或是jwt。目前情况是jwt仍然无法代替session，cookies也会有人用。它们各自有自己的优势和缺点，不能因为有一些缺点就否认技术的存在，缺点仍然可以采用一些技术手段来弥补，比如通过添加csrf token来阻止来自CSRF的攻击，比如利用redis集群来做session的存储和共享。技术只是工具，选择最适合你的才是最重要的。